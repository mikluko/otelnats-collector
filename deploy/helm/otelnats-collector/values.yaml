# Default values for otelnats-collector

# Mode: "gateway" (OTLP -> NATS) or "ingest" (NATS -> backend)
mode: gateway

replicaCount: 1

image:
  repository: ghcr.io/mikluko/otelnats-collector
  pullPolicy: IfNotPresent
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

service:
  type: ClusterIP
  # OTLP gRPC port (only exposed in gateway mode)
  otlpGrpcPort: 4317
  # OTLP HTTP port (only exposed in gateway mode)
  otlpHttpPort: 4318

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}

tolerations: []

affinity: {}

# Topology spread constraints for distributing pods across nodes/zones
# Example: spread pods evenly across zones and nodes
# topologySpreadConstraints:
#   - maxSkew: 1
#     topologyKey: topology.kubernetes.io/zone
#     whenUnsatisfiable: ScheduleAnyway
#     labelSelector:
#       matchLabels:
#         app.kubernetes.io/name: otelnats-collector
#   - maxSkew: 1
#     topologyKey: kubernetes.io/hostname
#     whenUnsatisfiable: ScheduleAnyway
#     labelSelector:
#       matchLabels:
#         app.kubernetes.io/name: otelnats-collector
topologySpreadConstraints: []

# Horizontal Pod Autoscaler settings
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
  # Optional behavior configuration for scaling
  # behavior:
  #   scaleDown:
  #     stabilizationWindowSeconds: 300
  #     policies:
  #       - type: Percent
  #         value: 10
  #         periodSeconds: 60
  #   scaleUp:
  #     stabilizationWindowSeconds: 0
  #     policies:
  #       - type: Percent
  #         value: 100
  #         periodSeconds: 15

# Pod Disruption Budget settings
podDisruptionBudget:
  enabled: false
  # minAvailable: 1
  # maxUnavailable: 1

# NATS connection settings
nats:
  url: nats://nats:4222
  auth:
    # Uncomment and configure the auth method you need:
    # userInfo:
    #   username: ""
    #   password: ""
    # token: ""
    # nkeyFile: ""
    # credentialsFile: ""

# Gateway mode settings (OTLP -> NATS)
gateway:
  # Subjects for each signal type
  traces:
    subject: otel.traces
  metrics:
    subject: otel.metrics
  logs:
    subject: otel.logs
  # Exporter settings
  timeout: 5s
  retryOnFailure:
    enabled: true
    initialInterval: 1s
    maxInterval: 30s
    maxElapsedTime: 300s

# Ingest mode settings (NATS -> backend)
ingest:
  # JetStream configuration (optional)
  # If enabled, uses JetStream consumers instead of queue groups for at-least-once delivery
  jetstream:
    enabled: false
    stream: OTEL_TELEMETRY
    consumer: otel-collector
    # Optional: ack wait timeout for JetStream messages
    ackWait: 30s
    # Optional: backlog size for JetStream consumer
    backlogSize: 100
  # Subjects and queue groups for each signal type (queue groups only used when JetStream disabled)
  traces:
    subject: otel.traces
    queueGroup: otel-traces-ingest
  metrics:
    subject: otel.metrics
    queueGroup: otel-metrics-ingest
  logs:
    subject: otel.logs
    queueGroup: otel-logs-ingest
  # Backend export settings
  backend:
    # OTLP gRPC endpoint (for traces/logs)
    otlp:
      endpoint: ""
      insecure: true
    # OTLP HTTP endpoint (for metrics)
    otlphttp:
      endpoint: ""
      insecure: true

# Batch processor settings
batch:
  timeout: 1s
  sendBatchSize: 1000

# Memory limiter settings (gateway mode only)
memoryLimiter:
  checkInterval: 1s
  limitMib: 512
  spikeLimitMib: 128

# Telemetry settings
telemetry:
  logs:
    level: info
  metrics:
    level: normal

# Additional config to merge (raw YAML)
extraConfig: {}

# Extra volumes to mount (for secrets, configmaps, etc.)
# Example:
#   extraVolumes:
#     - name: nats-creds
#       secret:
#         secretName: nats-credentials
extraVolumes: []

# Extra volume mounts for the collector container
# Example:
#   extraVolumeMounts:
#     - name: nats-creds
#       mountPath: /etc/nats
#       readOnly: true
extraVolumeMounts: []
